"""
Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø²ÙŠ ÙÙŠ Ø§Ù„Ø´Ù…Ø§Ù„ ğŸª
Ù…ØºØ§Ù…Ø±Ø§Øª Ø«Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙÙŠ Ø´Ù…Ø§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
"""

import pygame
import random
import sys
import os

# ØªÙ‡ÙŠØ¦Ø© Pygame
pygame.init()

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©
WIDTH, HEIGHT = 800, 400
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Ø¹Ù†Ø²ÙŠ ÙÙŠ Ø§Ù„Ø´Ù…Ø§Ù„ - Ù…ØºØ§Ù…Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø´Ù…Ø§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ")

# Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø³ØªÙˆØ­Ø§Ø© Ù…Ù† Ø¨ÙŠØ¦Ø© Ø´Ù…Ø§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
WHITE = (255, 255, 255)
BLACK = (0, 0, 0)
BROWN = (139, 69, 19)
GREEN = (34, 139, 34)
SKY_BLUE = (135, 206, 235)
SAND = (194, 178, 128)
GOLD = (255, 215, 0)

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
class Player:
    def __init__(self):
        self.x = 50
        self.y = HEIGHT - 100
        self.width = 40
        self.height = 60
        self.speed = 5
        self.jump_power = 15
        self.is_jumping = False
        self.jump_count = self.jump_power
        self.health = 100
        self.coins = 0
        self.score = 0
        self.direction = 1  # 1 Ù„Ù„ÙŠÙ…ÙŠÙ†ØŒ -1 Ù„Ù„ÙŠØ³Ø§Ø±
        self.invincible = 0  # Ù…Ù†Ø§Ø¹Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµØ§Ø¨Ø©
    
    def draw(self):
        # Ø±Ø³Ù… Ø¬Ø³Ù… Ø¹Ù†Ø²ÙŠ
        pygame.draw.rect(screen, (100, 70, 30), (self.x, self.y, self.width, self.height))
        
        # Ø±Ø³Ù… Ø§Ù„Ø±Ø£Ø³
        pygame.draw.circle(screen, (210, 180, 140), (self.x + self.width//2, self.y - 10), 20)
        
        # Ø±Ø³Ù… Ø§Ù„ØºØªØ±Ø© (Ù…Ø«Ù„Ø«)
        points = [(self.x + self.width//2, self.y - 30), 
                 (self.x + self.width//2 - 15, self.y - 15),
                 (self.x + self.width//2 + 15, self.y - 15)]
        pygame.draw.polygon(screen, (255, 255, 255), points)
        
        # Ø§Ù„Ø¹ÙŠÙˆÙ†
        eye_x = self.x + self.width//2 + (5 * self.direction)
        pygame.draw.circle(screen, BLACK, (eye_x, self.y - 12), 5)
    
    def move(self, keys):
        if keys[pygame.K_LEFT]:
            self.x -= self.speed
            self.direction = -1
        if keys[pygame.K_RIGHT]:
            self.x += self.speed
            self.direction = 1
        
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø§Ø´Ø©
        if self.x < 0:
            self.x = 0
        if self.x > WIDTH - self.width:
            self.x = WIDTH - self.width
            
        # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø§Ø¹Ø©
        if self.invincible > 0:
            self.invincible -= 1
    
    def jump(self):
        if not self.is_jumping:
            self.is_jumping = True
    
    def update_jump(self):
        if self.is_jumping:
            if self.jump_count >= -self.jump_power:
                neg = 1
                if self.jump_count < 0:
                    neg = -1
                self.y -= (self.jump_count ** 2) * 0.5 * neg
                self.jump_count -= 1
            else:
                self.is_jumping = False
                self.jump_count = self.jump_power

# Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª
class Character:
    def __init__(self, x, y, char_type):
        self.x = x
        self.y = y
        self.width = 30
        self.height = 50
        self.type = char_type  # 'friendly', 'aggressive', 'mysterious'
        self.speed = random.randint(1, 3)
        self.direction = random.choice([-1, 1])
        self.interaction_cooldown = 0
        
        # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        if self.type == 'friendly':
            self.color = (0, 100, 0)  # Ø£Ø®Ø¶Ø±
        elif self.type == 'aggressive':
            self.color = (200, 0, 0)  # Ø£Ø­Ù…Ø±
        else:
            self.color = (128, 0, 128)  # Ø¨Ù†ÙØ³Ø¬ÙŠ
    
    def draw(self):
        pygame.draw.rect(screen, self.color, (self.x, self.y, self.width, self.height))
        
        # Ø±Ø³Ù… Ø§Ù„Ø±Ø£Ø³
        pygame.draw.circle(screen, (210, 180, 140), (self.x + self.width//2, self.y - 10), 15)
        
        # Ø§Ù„Ø¹ÙŠÙˆÙ†
        pygame.draw.circle(screen, BLACK, (self.x + self.width//2 - 5, self.y - 10), 3)
        pygame.draw.circle(screen, BLACK, (self.x + self.width//2 + 5, self.y - 10), 3)
    
    def move(self):
        self.x += self.speed * self.direction
        
        # ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø§ÙØ©
        if self.x <= 0 or self.x >= WIDTH - self.width:
            self.direction *= -1
    
    def interact(self, player):
        if self.interaction_cooldown > 0:
            self.interaction_cooldown -= 1
            return None
        
        # Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ§Ù„Ù„Ø§Ø¹Ø¨
        distance = ((self.x - player.x) ** 2 + (self.y - player.y) ** 2) ** 0.5
        
        if distance < 50:  # Ø¥Ø°Ø§ ÙƒØ§Ù†Ø§ Ù‚Ø±ÙŠØ¨ÙŠÙ† Ø¨Ù…Ø§ ÙŠÙƒÙÙŠ Ù„Ù„ØªÙØ§Ø¹Ù„
            if self.type == 'friendly':
                player.coins += 1
                player.score += 10
                self.interaction_cooldown = 60
                return "ØµØ¯ÙŠÙ‚: Ø£Ù‡Ù„Ø§Ù‹! Ø®Ø° Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„Ø©!"
            
            elif self.type == 'aggressive':
                if player.invincible == 0:
                    player.health -= 10
                    player.invincible = 30  # Ù…Ù†Ø§Ø¹Ø© Ù„Ù…Ø¯Ø© 30 Ø¥Ø·Ø§Ø±
                self.interaction_cooldown = 60
                return "Ø¹Ø¯ÙˆØ§Ù†ÙŠ: Ø§Ø¨ØªØ¹Ø¯ Ø¹Ù† Ø·Ø±ÙŠÙ‚ÙŠ!"
            
            else:  # mysterious
                effect = random.choice(['help', 'harm'])
                if effect == 'help':
                    player.health += 5
                    if player.health > 100:
                        player.health = 100
                    self.interaction_cooldown = 60
                    return "ØºØ§Ù…Ø¶: Ø­Ø¸Ø§Ù‹ Ø³Ø¹ÙŠØ¯Ø§Ù‹ ÙÙŠ Ø±Ø­Ù„ØªÙƒ!"
                else:
                    if player.invincible == 0:
                        player.health -= 5
                        player.invincible = 30
                    self.interaction_cooldown = 60
                    return "ØºØ§Ù…Ø¶: Ø±Ø¨Ù…Ø§ ÙƒØ§Ù† Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø¨Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„!"
        
        return None

# Ø§Ù„Ø¹Ù…Ù„Ø§Øª
class Coin:
    def __init__(self):
        self.x = random.randint(50, WIDTH - 50)
        self.y = random.randint(50, HEIGHT - 150)
        self.radius = 10
        self.collected = False
    
    def draw(self):
        if not self.collected:
            pygame.draw.circle(screen, GOLD, (self.x, self.y), self.radius)
    
    def collect(self, player):
        if self.collected:
            return False
            
        distance = ((self.x - player.x) ** 2 + (self.y - player.y) ** 2) ** 0.5
        if distance < 30:
            self.collected = True
            player.coins += 1
            player.score += 5
            return True
        return False

# Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
def draw_background():
    # Ø§Ù„Ø³Ù…Ø§Ø¡
    screen.fill(SKY_BLUE)
    
    # Ø§Ù„Ø´Ù…Ø³
    pygame.draw.circle(screen, (255, 255, 0), (700, 80), 40)
    
    # Ø§Ù„Ø¬Ø¨Ø§Ù„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    for i in range(3):
        x = 100 + i * 250
        points = [(x, HEIGHT - 50), (x + 100, HEIGHT - 150), (x + 200, HEIGHT - 50)]
        pygame.draw.polygon(screen, (120, 120, 120), points)
    
    # Ø§Ù„Ø£Ø±Ø¶
    pygame.draw.rect(screen, SAND, (0, HEIGHT - 50, WIDTH, 50))
    
    # Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª Ø§Ù„ØµØ­Ø±Ø§ÙˆÙŠØ©
    for i in range(8):
        x = random.randint(0, WIDTH)
        pygame.draw.rect(screen, GREEN, (x, HEIGHT - 70, 5, 20))
        pygame.draw.circle(screen, GREEN, (x, HEIGHT - 75), 10)

# Ø§Ù„Ù†Øµ
font = pygame.font.SysFont(None, 24)
large_font = pygame.font.SysFont(None, 48)

# Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
def show_start_screen():
    screen.fill(SKY_BLUE)
    
    title_text = large_font.render("Ø¹Ù†Ø²ÙŠ ÙÙŠ Ø§Ù„Ø´Ù…Ø§Ù„", True, BLACK)
    subtitle_text = font.render("Ù…ØºØ§Ù…Ø±Ø§Øª ÙÙŠ Ø´Ù…Ø§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©", True, BLACK)
    start_text = font.render("Ø§Ø¶ØºØ· Ø£ÙŠ Ø²Ø± Ù„Ù„Ø¨Ø¯Ø¡", True, BLACK)
    controls_text = font.render("Ø§Ù„ØªØ­ÙƒÙ…: Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„Ø­Ø±ÙƒØ©, Ø§Ù„Ù…Ø³Ø§ÙØ© Ù„Ù„Ù‚ÙØ²", True, BLACK)
    
    screen.blit(title_text, (WIDTH//2 - title_text.get_width()//2, 100))
    screen.blit(subtitle_text, (WIDTH//2 - subtitle_text.get_width()//2, 160))
    screen.blit(controls_text, (WIDTH//2 - controls_text.get_width()//2, 200))
    screen.blit(start_text, (WIDTH//2 - start_text.get_width()//2, 250))
    
    pygame.display.flip()
    
    waiting = True
    while waiting:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                sys.exit()
            if event.type == pygame.KEYDOWN:
                waiting = False

# Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
def main_game():
    # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª
    player = Player()
    characters = []
    coins = []

    for _ in range(5):
        x = random.randint(100, WIDTH - 100)
        y = HEIGHT - 100
        char_type = random.choice(['friendly', 'aggressive', 'mysterious'])
        characters.append(Character(x, y, char_type))

    for _ in range(10):
        coins.append(Coin())

    # Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    message = ""
    message_timer = 0

    # Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    clock = pygame.time.Clock()
    running = True

    while running:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                return False
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_SPACE:
                    player.jump()
                if event.key == pygame.K_ESCAPE:
                    return True  # Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

        # Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ø§Ø¹Ø¨
        keys = pygame.key.get_pressed()
        player.move(keys)
        player.update_jump()

        # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø®ØµÙŠØ§Øª
        for char in characters:
            char.move()
            msg = char.interact(player)
            if msg:
                message = msg
                message_timer = 120

        # Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
        coins_to_remove = []
        for coin in coins:
            if coin.collect(player):
                coins_to_remove.append(coin)
        
        # Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù…ÙƒØ§Ù† Ø§Ù„ØªÙŠ ØªÙ… Ø¬Ù…Ø¹Ù‡Ø§
        for coin in coins_to_remove:
            coins.remove(coin)
            coins.append(Coin())

        # Ø±Ø³Ù… ÙƒÙ„ Ø´ÙŠØ¡
        draw_background()

        for coin in coins:
            coin.draw()

        for char in characters:
            char.draw()

        # ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø¹Ø© (ÙˆÙ…ÙŠØ¶)
        if player.invincible == 0 or player.invincible % 6 < 3:
            player.draw()

        # Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        health_text = font.render(f"Ø§Ù„ØµØ­Ø©: {player.health}", True, BLACK)
        coins_text = font.render(f"Ø§Ù„Ø¹Ù…Ù„Ø§Øª: {player.coins}", True, BLACK)
        score_text = font.render(f"Ø§Ù„Ù†Ù‚Ø§Ø·: {player.score}", True, BLACK)

        screen.blit(health_text, (10, 10))
        screen.blit(coins_text, (10, 40))
        screen.blit(score_text, (10, 70))

        # Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        if message_timer > 0:
            message_text = font.render(message, True, BLACK)
            screen.blit(message_text, (WIDTH//2 - message_text.get_width()//2, 20))
            message_timer -= 1

        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
        if player.health <= 0:
            game_over_text = large_font.render("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!", True, BLACK)
            final_score_text = font.render(f"Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: {player.score}", True, BLACK)
            restart_text = font.render("Ø§Ø¶ØºØ· R Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø£Ùˆ ESC Ù„Ù„Ø®Ø±ÙˆØ¬", True, BLACK)
            
            screen.blit(game_over_text, (WIDTH//2 - game_over_text.get_width()//2, HEIGHT//2 - 50))
            screen.blit(final_score_text, (WIDTH//2 - final_score_text.get_width()//2, HEIGHT//2))
            screen.blit(restart_text, (WIDTH//2 - restart_text.get_width()//2, HEIGHT//2 + 50))
            
            pygame.display.flip()
            
            waiting = True
            while waiting:
                for event in pygame.event.get():
                    if event.type == pygame.QUIT:
                        return False
                    if event.type == pygame.KEYDOWN:
                        if event.key == pygame.K_r:
                            return True  # Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                        if event.key == pygame.K_ESCAPE:
                            return True  # Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

        pygame.display.flip()
        clock.tick(60)
    
    return True

# Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
def main():
    show_start_screen()
    
    while True:
        restart = main_game()
        if not restart:
            break
        show_start_screen()

    pygame.quit()
    sys.exit()

if __name__ == "__main__":
    main()
